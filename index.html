<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Matt Wynne">
<title>Understanding Screenplay</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Understanding Screenplay</h1>
<div class="details">
<span id="author" class="author">Matt Wynne</span><br>
<span id="email" class="email"><a href="mailto:matt@cucumber.io">matt@cucumber.io</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_myths_about_screenplay">Myths about Screenplay</a>
<ul class="sectlevel2">
<li><a href="#_myth_1_screenplay_is_for_testing_screens">Myth #1: Screenplay is for testing screens</a></li>
<li><a href="#_myth_2_screenplay_is_over_complicated">Myth #2: Screenplay is over-complicated</a></li>
</ul>
</li>
<li><a href="#_the_fundamentals_of_screenplay">The fundamentals of Screenplay</a></li>
<li><a href="#_whats_wrong_with_helpers">What&#8217;s wrong with helpers?</a>
<ul class="sectlevel2">
<li><a href="#_time_for_an_example">Time for an example</a></li>
<li><a href="#_where_do_the_helper_methods_live">Where do the helper methods live?</a></li>
<li><a href="#_a_new_requirement">A new requirement</a></li>
<li><a href="#_cracks_are_appearing">Cracks are appearing</a></li>
<li><a href="#_what_about_page_objects">What about Page Objects?</a></li>
</ul>
</li>
<li><a href="#_refactoring_to_screenplay">Refactoring to Screenplay</a>
<ul class="sectlevel2">
<li><a href="#_extract_interaction">Extract Interaction</a></li>
<li><a href="#_actors_perform_interactions_using_abilities">Actors perform Interactions using Abilities</a></li>
<li><a href="#_using_a_custom_parameter_type">Using a custom parameter type</a></li>
<li><a href="#_naming_our_interaction">Naming our Interaction</a></li>
<li><a href="#_wrapping_up">Wrapping up</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Once you&#8217;ve decided to invest in test automation, sooner or later you&#8217;ll begin to realise that you need to care about the maintainability of that test automation code just as much as you do about the implementation code itself.</p>
</div>
<div class="paragraph">
<p>For acceptance tests this problem is particularly acute: driving the application from its outside edges can involve connecting to APIs, databases, web UIs etc., and this code can quickly get out of hand. Having tried several different approaches myself over the years, I&#8217;ve come to believe that the Screenplay pattern is the best technique we have today for keeping this code lean and fun to work with.</p>
</div>
<div class="paragraph">
<p>But it doesn&#8217;t get the attention it deserves.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve never heard of Screenplay, or have heard of it but never tried it, this tutorial is for you. It will be technical, with a good deal of code. The code will be in JavaScript, but I hope you&#8217;ll be able to follow it if you&#8217;re familiar with coding in any other language too.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_myths_about_screenplay">Myths about Screenplay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First I want to start by addressing a couple of popular misconceptions about the pattern, and give you a quick view of the fundamentals, to help frame the rest of what&#8217;s to come.</p>
</div>
<div class="sect2">
<h3 id="_myth_1_screenplay_is_for_testing_screens">Myth #1: Screenplay is for testing screens</h3>
<div class="paragraph">
<p>Many people I&#8217;ve talked to about Screenplay have heard the word "screen", or read the blog posts contrasting it with the page object pattern, and assumed it must be only for UI testing. That&#8217;s not the case.</p>
</div>
<div class="paragraph">
<p>The folks behind the screenplay pattern love a metaphor.</p>
</div>
<div class="paragraph">
<p>The metaphor here is not about screens from the user interface of your app, no! The metaphor is that each of your scenarios is like a little stage-play, with actors performing actions.</p>
</div>
<div class="paragraph">
<p>In fact, as we&#8217;ll see, the whole idea is to get away from thinking about interaction details, and focus on behaviour and intent.</p>
</div>
<div class="paragraph">
<p>In retrospect, maybe something like <em>Playwright</em> might have made a better name for this pattern to avoid any confusion caused by conflated interpretations of the word "screen". Anyway, it&#8217;s too late for that now.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s be totally clear. The Screenplay pattern does not have anything to say about whether you test through your UI or not. In fact, Screenplay can help free you up from this hideous bind, and give you more choices about where to connect to your app, and keep your code better organised.</p>
</div>
</div>
<div class="sect2">
<h3 id="_myth_2_screenplay_is_over_complicated">Myth #2: Screenplay is over-complicated</h3>
<div class="paragraph">
<p>I&#8217;ll admit that this was my reaction at first. Even though I had a strong feeling there was something useful in this pattern, I found all the early examples I read to be quite hard to fathom, with a lot of new concepts to understand. It all made me feel a bit stupid.</p>
</div>
<div class="paragraph">
<p>Having got my head around it now, I can tell you for sure that there&#8217;s a super-simple core idea here. Essentially, Screenplay is just the [command pattern](<a href="https://en.wikipedia.org/wiki/Command_pattern" class="bare">https://en.wikipedia.org/wiki/Command_pattern</a>) applied in the specific context of organising test automation code.</p>
</div>
<div class="paragraph">
<p>In fact, I bet that if you&#8217;ve worked on a test automation suite of any reasonable size, you&#8217;ll know exactly what over-complicated feels like. Massive classes heaving with too many methods. Awkward hierarchies of objects to try and avoid duplication. A maze of different files.
This pattern is a way out of that.</p>
</div>
<div class="paragraph">
<p>If I&#8217;ve done my job right then, by the end of this series, you&#8217;ll see that it&#8217;s really not that complicated at all.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_fundamentals_of_screenplay">The fundamentals of Screenplay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The fundamental element of the Screenplay pattern is an <em>Interaction</em>. Instead of having the code that interacts with our app littered around in helper methods or page objects, we separate and encapsulate each tiny granule of work as an individual object, each with the same interface: a single method that allows us to run that action against our app.</p>
</div>
<div class="paragraph">
<p>For example, you might have an Interaction like <code>InsertInto</code> which knows how to insert a record into an SQL database table. Or you might have an Interaction like <code>WriteTo</code> that can write to a text file on disk. Or an Interaction like <code>FillIn</code> which can put text into a field in a browser. Or an Interaction like <code>PostJson</code> that sends a payload to an API endpoint.</p>
</div>
<div class="paragraph">
<p>Then, we express the behaviour we want in our tests by creating lists of these Interaction objects that we want to execute, like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">attemptTo</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">InsertInto</span><span class="p">({</span>
    <span class="na">table</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Accounts</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span><span class="p">,</span> <span class="na">company</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ACME</span><span class="dl">"</span> <span class="p">}</span>
  <span class="p">}),</span>
  <span class="k">new</span> <span class="nx">FillIn</span><span class="p">({</span>
    <span class="na">field</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Username</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">with</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span>
  <span class="p">}),</span>
  <span class="k">new</span> <span class="nx">FillIn</span><span class="p">({</span>
    <span class="na">field</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Password</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">with</span><span class="p">:</span> <span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span>
  <span class="p">})</span>
  <span class="k">new</span> <span class="nx">ClickOn</span><span class="p">({</span> <span class="na">button</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Login</span><span class="dl">"</span> <span class="p">})</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This set of interactions creates a record in a database to represent a user called <code>Dave</code>, then fills out a web form to log him in.</p>
</div>
<div class="paragraph">
<p>We can create factory DSLs to make this code read better:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">attemptTo</span><span class="p">(</span>
  <span class="nx">InsertInto</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="dl">"</span><span class="s2">Accounts</span><span class="dl">"</span><span class="p">).</span><span class="nx">data</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span><span class="p">,</span> <span class="na">company</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ACME</span><span class="dl">"</span> <span class="p">}),</span>
  <span class="nx">FillIn</span><span class="p">.</span><span class="nx">field</span><span class="p">(</span><span class="dl">"</span><span class="s2">Username</span><span class="dl">"</span><span class="p">).</span><span class="kd">with</span><span class="p">(</span><span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">FillIn</span><span class="p">.</span><span class="nx">field</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password</span><span class="dl">"</span><span class="p">).</span><span class="kd">with</span><span class="p">(</span><span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">ClickOn</span><span class="p">.</span><span class="nx">button</span><span class="p">(</span><span class="dl">"</span><span class="s2">Login</span><span class="dl">"</span> <span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sweet thing about breaking down our automation into these tiny pieces is that it allows us to compose these little Interactions into bigger chunks (called Tasks) that make sense in our particular problem domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">attemptTo</span><span class="p">(</span>
  <span class="nx">CreateAccount</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span><span class="p">).</span><span class="nx">withPassword</span><span class="p">(</span><span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span><span class="p">),</span>
  <span class="nx">Login</span><span class="p">.</span><span class="k">as</span><span class="p">(</span><span class="dl">"</span><span class="s2">Dave</span><span class="dl">"</span><span class="p">).</span><span class="nx">withPassword</span><span class="p">(</span><span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic shift in thinking that you&#8217;ll need to grasp in order to understand the Screenplay pattern is this: all of your automation behaviour is going to be organised into little elemental pieces instead of being in methods on helper classes.</p>
</div>
<div class="paragraph">
<p>Screenplay doesn&#8217;t have to be something you can only introduce into your next greenfield project. We&#8217;ve successfully introduced Screenplay side-by-side with existing automation code, gradually refactoring towards it.</p>
</div>
<div class="paragraph">
<p>Over the course of this tutorial, we&#8217;ll refactor take a typical Cucumber codebase and refactor it towards this pattern, extracting and develop our own little Screenplay library as we go. In doing this, you&#8217;ll get a firm handle on how to apply the pattern yourself.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_wrong_with_helpers">What&#8217;s wrong with helpers?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the first post in this series we introduced the concept of the Screenplay pattern and busted a couple of popular myths about it. Now it&#8217;s time to start digging into some code to give us a real example to demonstrate the pattern on.</p>
</div>
<div class="paragraph">
<p>The problem with writing this kind of tutorial, always, is finding the right balance between an example that&#8217;s so complicated it gets in the way of your understanding the thing we&#8217;re actually trying to learn about, and one that&#8217;s so simplistic that the need for any kind of software design seems superfluous. If you&#8217;ll forgive me, we&#8217;ll err towards the simplistic here, and I&#8217;ll trust that you&#8217;ve seen enough complex code in the wild to recognise the need for some design work.</p>
</div>
<div class="sect2">
<h3 id="_time_for_an_example">Time for an example</h3>
<div class="paragraph">
<p>Turn your imagination up to max and pretend we&#8217;re building a web-based app that needs people to be able to sign up. This sign up feature is going to be the big differentiator to help us stand out in the market, I can feel it.</p>
</div>
<div class="paragraph">
<p>Sign-up is a two-step process, as described in this feature file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Sign up

  New accounts need to confirm their email to activate
  their account.

  <span class="kn">Scenario</span><span class="p">:</span> Successful sign-up
    <span class="nf">Given </span>Tanya has created an account
    <span class="nf">When </span>Tanya activates her account
    <span class="nf">Then </span>Tanya should be authenticated

  <span class="kn">Scenario</span><span class="p">:</span> Try to sign in without activating account
    <span class="nf">Given </span>Bob has created an account
    <span class="nf">When </span>Bob tries to sign in
    <span class="nf">Then </span>Bob should not be authenticated
    <span class="nf">And </span>Bob should see an error telling him to activate the account</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far so good. We have one happy path scenario for Tanya creating then activating her account, and being able to sign in. We have another that illustrates what happens if hapless Bob tries to sign in before he&#8217;s got around to activating the account.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s drop down a layer and have a look at the step definitions we&#8217;ve written that bring these scenarios to life our JavaScript project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span><span class="p">,</span> <span class="nx">not</span><span class="p">,</span> <span class="nx">matchesPattern</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} tries to sign in</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">signIn</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} activates his/her account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">activateAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should not be authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span> <span class="nx">is</span><span class="p">(</span><span class="nx">not</span><span class="p">(</span><span class="kc">true</span><span class="p">)))</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should be authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span> <span class="nx">is</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should see an error telling him/her to activate the account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">authenticationError</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span>
    <span class="nx">matchesPattern</span><span class="p">(</span><span class="sr">/activate your account/</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a couple of things going on here, so let&#8217;s pick them apart.</p>
</div>
<div class="paragraph">
<p>We can see that each step definition uses the cucumber expression syntax, avoiding the need for ugly regular expressions, and instead capturing the name of the user with the built in <code>{word}</code> parameter type. Partly, I just wanted to show off this new feature, but it&#8217;s also going to come in handy later.</p>
</div>
<div class="paragraph">
<p>Next, notice that each of the step definition functions is a one-liner, delegating to a method on <code>this</code>. Delegating the automation work to helper methods allows us to keep a separation of concerns between these two layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step Definitions translate from plain English in the scenarios into code.</p>
</li>
<li>
<p>Helper, or driver methods actually interact with the app.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Working this way, we build up a library of re-usable driver code that does the actual leg-work of automating our app. Gradually, we develop an API (some people even call it a DSL) for driving our application from our tests.</p>
</div>
<div class="paragraph">
<p>Introducing this separation also allows us the flexibility to swap in different implementations of the driver API, when we want to connect our automation at different layers of the app. If we want to, we can have a SeleniumDriver that uses a browser (perhaps via page objects), and a DomainDriver that does the same things directly against the domain model.</p>
</div>
<div class="paragraph">
<p>But I digress.</p>
</div>
</div>
<div class="sect2">
<h3 id="_where_do_the_helper_methods_live">Where do the helper methods live?</h3>
<div class="paragraph">
<p>In cucumber-js projects, <code>this</code> in the context of a step definition function is the World, an object that is created by Cucumber for the duration of the scenario, which we can add custom methods and properties to. Ruby&#8217;s flavour of Cucumber offers the same concept. In Cucumber-JVM and SpecFlow projects you have to inject your own objects that contain your helpers, but the principle is the same.</p>
</div>
<div class="paragraph">
<p>We won&#8217;t dig any deeper into our automation stack right now. Let&#8217;s just trust that those helper methods are there, doing what they say they do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_new_requirement">A new requirement</h3>
<div class="paragraph">
<p>As they tend to do from time to time, our product owner would like this app of ours to do something new. She has an idea that our app will have projects that users with existing accounts can create. I don&#8217;t know where she gets these wild ideas.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the feature file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="gherkin"><span class="kd">Feature</span><span class="p">:</span> Create project

  Users can create projects, only visible to themselves

  <span class="kn">Scenario</span><span class="p">:</span> Create one project
    <span class="nf">Given </span>Sue has signed up
    <span class="nf">When </span>Sue creates a project
    <span class="nf">Then </span>Sue should see the project

  <span class="kn">Scenario</span><span class="p">:</span> Try to see someone else's project
    <span class="nf">Given </span>Sue has signed up
    <span class="nf">And </span>Bob has signed up
    <span class="nf">When </span>Sue creates a project
    <span class="nf">Then </span>Bob should not see any projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve introduced a handful of new steps here. Let&#8217;s look at how these are defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="kd">const</span> <span class="p">{</span> <span class="nx">Given</span><span class="p">,</span> <span class="nx">When</span><span class="p">,</span> <span class="nx">Then</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">assertThat</span><span class="p">,</span> <span class="nx">is</span><span class="p">,</span> <span class="nx">not</span><span class="p">,</span> <span class="nx">matchesPattern</span><span class="p">,</span> <span class="nx">hasItem</span><span class="p">,</span> <span class="nx">isEmpty</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">hamjest</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} tries to sign in</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">signIn</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} activates his/her account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">activateAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has signed up</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">activateAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span>

<span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} (tries to )create(s) a project</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createProject</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="na">project</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">a-project</span><span class="dl">'</span> <span class="p">}})</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should see the project</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getProjects</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span>
    <span class="nx">hasItem</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">a-project</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">)</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should not see any projects</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getProjects</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span>
    <span class="nx">isEmpty</span><span class="p">()</span>
  <span class="p">)</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should not be authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span> <span class="nx">is</span><span class="p">(</span><span class="nx">not</span><span class="p">(</span><span class="kc">true</span><span class="p">)))</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should be authenticated</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span> <span class="nx">is</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should see an error telling him/her to activate the account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">authenticationError</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span>
    <span class="nx">matchesPattern</span><span class="p">(</span><span class="sr">/activate your account/</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This all seems quite straightforward in our simple example, but if we&#8217;re really sensitive to them, we might notice a couple of issues that could cause concern as the codebase grows.</p>
</div>
<div class="paragraph">
<p>First, we have duplication of the project name, <code>a-project</code>. We&#8217;ve made the sensible choice to push this detail down out of the scenarios to make them more readable (avoiding incidental details), but we&#8217;re now left with the problem of needing that information in two places in our code. One solution might be to stash the project name on the World, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">When</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} (tries to )create(s) a project</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">projectName</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">a-project</span><span class="dl">'</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createProject</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="na">project</span><span class="p">:</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">projectName</span> <span class="p">}})</span>
<span class="p">})</span>

<span class="nx">Then</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} should see the project</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assertThat</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getProjects</span><span class="p">({</span> <span class="nx">name</span> <span class="p">}),</span>
    <span class="nx">hasItem</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">projectName</span> <span class="p">})</span>
  <span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use Cucumber-Ruby you&#8217;ve probably done this kind of thing using an instance variable. SpecFlow or Cucumber-JVM practitioners maybe have used a ScenarioContext object. Like using helper methods, this is common practice in the Cucumber community. While this will work OK for now, what we&#8217;re starting to see is that the World object is just getting more and more complicated.</p>
</div>
<div class="paragraph">
<p>It&#8217;s becoming a God object.</p>
</div>
<div class="paragraph">
<p>Well-designed objects have the property of <em>cohesion</em>. That means the methods on that object all have a reason to be together, such as sharing the same internal state. God objects don&#8217;t have this property. They&#8217;re just a grab-bag of methods, properties and state that have no reason to be on the same class other than for a lack of a better place to put them.</p>
</div>
<div class="paragraph">
<p>Another niggling concern is that we&#8217;ve broken our idiom of having one-liner step definitions. We&#8217;re introduced the concept of "signing up" which rolls together the two granular actions of creating an account and then activating it.</p>
</div>
<div class="paragraph">
<p>At this stage, a two-line step definition is not a big deal, but it&#8217;s the wrong direction of travel. As we build up a more rich and interesting system we&#8217;ll have more and more of these abstractions. We could push this down into a <code>signUp</code> helper method on the world, but this doesn&#8217;t actually tackle the complexity, it just pushes it away somewhere we can&#8217;t see it so easily.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cracks_are_appearing">Cracks are appearing</h3>
<div class="paragraph">
<p>Let&#8217;s take a step back for a minute and review what we do and don&#8217;t like about this code so far.</p>
</div>
<div class="paragraph">
<p>On the up-side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The scenarios read really nicely. We&#8217;re not being forced to put details into the scenarios for the sake of what&#8217;s easy to code.</p>
</li>
<li>
<p>We&#8217;ve got a good separation of concerns, with the step definitions staying simple, delegating the work of actually driving the application to helper methods.</p>
</li>
<li>
<p>The language in the step definition code is consistent with the language of the Gherkin steps. For example, we see calls to signUp and activateAccount methods rather than any details about click or fillIn. There&#8217;s no translation happening in the step defintions, so we can trust them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But we&#8217;re concerned that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we have duplication of hard-coded details like the name of the project, when we need to share implicit context (i.e. "the project") between steps.</p>
</li>
<li>
<p>adding more and more helper methods onto the World means that class will just grow and grow, and it will lack cohesion.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the moment, in this tiny example codebase, these concerns are only hairline cracks; but we know what happens as our codebase evolves: small problems turn into big problems and, before you know it, you&#8217;re stuck in a codebase you hate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_about_page_objects">What about Page Objects?</h3>
<div class="paragraph">
<p>What if we were to use page objects? Could they help us?</p>
</div>
<div class="paragraph">
<p>Certainly, having different objects to represent the sign up form, the login form, and the new project page, would avoid us lumping all our automation code into one World object. However, this doesn&#8217;t stop the bloat. Page objects that model every button and interaction point on a page can become huge and unwieldy.</p>
</div>
<div class="paragraph">
<p>A more insidious problem is that page objects are based around the UI. This means there would have to be a leap in translation in our step defintions: we&#8217;d jump from a problem-domain concept like create a project to the nitty-gritty interactions with the app that will cause this action to happen. This isn&#8217;t such a clean separation of concerns, and distracts us from focussing on the behaviour and intent of our users. If we&#8217;re not careful, these detailed interactions can start to leak out into the Gherkin.</p>
</div>
<div class="paragraph">
<p>So now we have a sense of some of the problems with the typical approaches to organising acceptance test automation code.</p>
</div>
<div class="paragraph">
<p>Next we&#8217;ll have a look at what Screenplay could offer us to solve these problems, and start using it in our example application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_refactoring_to_screenplay">Refactoring to Screenplay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When refactoring to Screenplay, I&#8217;ve found it&#8217;s best to start with the smallest elements of behaviour first. Let&#8217;s pick the <code>createAccount</code> helper method in the <code>DomainDriver</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We call this method twice from our steps. First, we use it for creating accounts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, later, we use it as part of signing up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has signed up</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">activateAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll work with the first instance to turn this into a Screenplay <em>interaction</em>. We&#8217;ll come back to the second one later.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s inline the first instance so that&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>becomes&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have the code back up in the step definition, we can re-shape it into a Screenplay style.</p>
</div>
<div class="sect2">
<h3 id="_extract_interaction">Extract Interaction</h3>
<div class="paragraph">
<p>We&#8217;ll put the code that does this work into an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">arrow function expression</a> which will become our first <em>Interaction</em>. The interaction takes all the dependencies and information it will need to do its work. In this case, it needs a reference to the <code>app</code> it will use to fetch the accounts, and the <code>name</code> of the actor.</p>
</div>
<div class="paragraph">
<p>To complete this first refactoring, we call the interaction function, passing the name from the step definition and destructuring <code>this</code> to give us the <code>app</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">interaction</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">app</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="nx">interaction</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="p">...</span><span class="k">this</span> <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the code does the same as it did before. We can run <code>npm test</code> at this point to check all our scenarios are still passing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_perform_interactions_using_abilities">Actors perform Interactions using Abilities</h3>
<div class="paragraph">
<p>Back in the first part of this series, we talked about the metaphor for Screenplay being actors on a stage.</p>
</div>
<div class="paragraph">
<p>anstead of calling our interaction directly from our step definition, we&#8217;re going to create an <code>Actor</code> that we&#8217;ll use to do that for us.</p>
</div>
<div class="paragraph">
<p>In the metaphor, the actor is said to have <em>abilities</em>: the things it needs to be able to perform the actions it&#8217;s given. In practice, these are the dependencies that the interaction functions will expect to be passed, like a <code>browser</code> or a <code>database</code> connection. We&#8217;ll take these as we construct the <code>Actor</code>.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll add a method that attempts to perform an interaction, by simply passing these abilities to the interaction and calling it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">class</span> <span class="nx">Actor</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">abilities</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">abilities</span> <span class="o">=</span> <span class="nx">abilities</span>
  <span class="p">}</span>

  <span class="nx">attemptsTo</span><span class="p">(</span><span class="nx">interaction</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">interaction</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">abilities</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perfect. Now, the actor has everything it needs to be able to attempt to perform an action.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how we use the shiny new <code>Actor</code> in our step definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{word} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">interaction</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">app</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="kd">const</span> <span class="nx">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Actor</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="p">...</span><span class="k">this</span> <span class="p">})</span>
  <span class="nx">actor</span><span class="p">.</span><span class="nx">attemptsTo</span><span class="p">(</span><span class="nx">interaction</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To construct the actor, we&#8217;re creating a bare JavaScript object representing the actor&#8217;s abilities to pass to the constructor; in this case their <code>name</code> and whatever attributes are on <code>this</code>.</p>
</div>
<div class="paragraph">
<p>Then we call <code>attemptsTo</code> on the actor, passing it our interaction.</p>
</div>
<div class="paragraph">
<p>Again, we can run <code>npm test</code> at this point to check all our scenarios are still passing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_custom_parameter_type">Using a custom parameter type</h3>
<div class="paragraph">
<p>Since the Screenplay pattern centres around these Actors, we don&#8217;t want to have to keep constructing them in our step definitions. Fortunately, Cucumber gives us <a href="https://cucumber.io/docs/cucumber/cucumber-expressions/#custom-parameter-types">custom parameter types</a> that allows us to transform the text <code>Sue</code>, <code>Tanya</code> or <code>Bob</code> into an instance of <code>Actor</code> that represents them.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how we do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="p">{</span> <span class="nx">defineParameterType</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cucumber</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">defineParameterType</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">actor</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">regexp</span><span class="p">:</span> <span class="sr">/</span><span class="se">(</span><span class="sr">Sue|Tanya|Bob</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span>
  <span class="na">transformer</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Actor</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="p">...</span><span class="k">this</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can ask for an instance of <code>Actor</code> in our step definition, by using the new custom parameter type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{actor} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actor</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">interaction</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">app</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
  <span class="nx">actor</span><span class="p">.</span><span class="nx">attemptsTo</span><span class="p">(</span><span class="nx">interaction</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our code is getting neater, but we&#8217;re not done yet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_naming_our_interaction">Naming our Interaction</h3>
<div class="paragraph">
<p>An idiom that Screenplay&#8217;s original authors used was to adopt a <a href="https://www.martinfowler.com/bliki/FluentInterface.html">fluent interface</a> for creating interactions. Let&#8217;s rename our interaction in this style, calling it <code>CreateAccount.forThemselves</code>. We do this by creating a plain JavaScript object, <code>CreateAccount</code>, with a property <code>forThemselves</code> that returns the interaction function expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">CreateAccount</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">forThemselves</span><span class="p">:</span>
    <span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">app</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">accounts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Account</span><span class="p">({</span> <span class="nx">name</span> <span class="p">})</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can use that in our step definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{actor} has created an account</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">actor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">actor</span><span class="p">.</span><span class="nx">attemptsTo</span><span class="p">(</span><span class="nx">CreateAccount</span><span class="p">.</span><span class="nx">forThemselves</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In fact, <a href="https://github.com/cucumber/cucumber-js/issues/467#issuecomment-172933376">since we&#8217;re no longer using <code>this</code></a>, we can now use an arrow function for our step definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">Given</span><span class="p">(</span><span class="dl">'</span><span class="s1">{actor} has created an account</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">actor</span> <span class="o">=&gt;</span> <span class="nx">actor</span><span class="p">.</span><span class="nx">attemptsTo</span><span class="p">(</span><span class="nx">CreateAccount</span><span class="p">.</span><span class="nx">forThemselves</span><span class="p">)</span>
<span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrapping_up">Wrapping up</h3>
<div class="paragraph">
<p>Hopefully you can see things starting to fall into place. We&#8217;re delegating the work in our step definitions off to <em>actors</em> and <em>interactions</em>. The <em>actors</em> have <em>abilities</em> that enable them to perform the interactions, but they&#8217;re completely decoupled from those interactions themselves. Each <em>interaction</em> is a separate JavaScript function that takes the <em>abilities</em> and does something to the system.</p>
</div>
<div class="paragraph">
<p>This decoupling enables this pattern to scale really well. We can add new interactions easily, without creating extra dependencies or bloated helper classes.</p>
</div>
<div class="paragraph">
<p>All of this leaves us with step defintions that are much more readable than before, with a clear mapping from the plain English in our Gherkin steps to the code that carries out the step.</p>
</div>
<div class="paragraph">
<p>The real beauty of the actor-interactions model is that interactions are <em>composable</em>: we can build up more interesting actions out of fine-grained interactions, like putting lego pieces together. That&#8217;s what we&#8217;ll look at next.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-02-27 17:02:35 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>